machine:
  java:
    version: openjdk7
  environment:
    #https://github.com/floragunncom/search-guard-ssl/issues/15
    #SG_ALLOW_OPENSSL: false
    MAVEN_OPTS: "-XX:HeapDumpPath=$CIRCLE_ARTIFACTS/ -XX:ErrorFile=$CIRCLE_ARTIFACTS/hs_err.log -XX:+HeapDumpOnOutOfMemoryError -Xloggc:$CIRCLE_ARTIFACTS/gclog.log -Xcheck:jni -XX:+PrintCommandLineFlags -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps"
    _JAVA_OPTIONS: "-XX:HeapDumpPath=$CIRCLE_ARTIFACTS/ -XX:ErrorFile=$CIRCLE_ARTIFACTS/hs_err.log -XX:+HeapDumpOnOutOfMemoryError -Xloggc:$CIRCLE_ARTIFACTS/gclog.log -Xcheck:jni -XX:+PrintCommandLineFlags -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps"
    ARTI: "$CIRCLE_ARTIFACTS"
    
dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install openssl libapr1
    
test:
  override:
    - echo $CIRCLE_ARTIFACTS
    - echo $MAVEN_OPTS
    - echo $ARTI
    - mvn integration-test -Dsurefire.argLine="-XX:HeapDumpPath=$ARTI/ -XX:ErrorFile=$ARTI/hs_errsf.log -XX:+HeapDumpOnOutOfMemoryError -Xloggc:$ARTI/gclogsf.log -Xcheck:jni -XX:+PrintCommandLineFlags -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps" -DargLine="-XX:HeapDumpPath=$ARTI/ -XX:ErrorFile=$ARTI/hs_errsf.log -XX:+HeapDumpOnOutOfMemoryError -Xloggc:$ARTI/gclogsf.log -Xcheck:jni -XX:+PrintCommandLineFlags -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps"
    - 'killall -9 java || echo "killed"'
    - 'ls -la'
    - 'cat *.log*'
    
general:
  branches:
    ignore:
      - gh-pages
